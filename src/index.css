@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-primary: 59 130 246;
  --color-secondary: 99 102 241;
  --color-accent: 236 72 153;
  --color-background: 249 250 251;
  --color-surface: 255 255 255;
  --color-text: 31 41 55;
}

.dark {
  --color-primary: 96 165 250;
  --color-secondary: 129 140 248;
  --color-accent: 244 114 182;
  --color-background: 17 24 39;
  --color-surface: 31 41 55;
  --color-text: 243 244 246;
}

/* ==================== FIXES GLOBAUX POUR MOBILE ==================== */

/* Reset et base pour scroll fluide partout */
html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}

body {
  font-family: 'Poppins', sans-serif;
  @apply bg-background text-text;
  
  /* Permet le scroll vertical PARTOUT par défaut */
  overflow-x: hidden;
  overflow-y: auto;
  
  /* Mobile optimizations */
  @media (max-width: 1023px) {
    /* Scroll naturel sur mobile */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: auto; /* Permet pull-to-refresh */
    touch-action: pan-y pan-x; /* Autorise tous les gestes de base */
    
    /* Améliore la performance sur mobile */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    
    /* Empêche le zoom accidentel sur double-tap mais garde pinch-zoom */
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
  }
}

.font-report {
  font-family: 'Lato', 'Calibri', 'Arial', sans-serif;
}

/* Container principal de l'app - assure scroll global */
#root {
  min-height: 100vh;
  overflow-x: hidden;
  
  @media (max-width: 1023px) {
    /* Scroll global fonctionnel sur mobile */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* ==================== FIXES POUR COMPOSANTS UI ==================== */

/* Fix pour les headers/navbars qui coupent le contenu */
.navbar, .header, [role="banner"] {
  @media (max-width: 1023px) {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 9999 !important;
    
    /* Safe areas */
    padding-left: env(safe-area-inset-left) !important;
    padding-right: env(safe-area-inset-right) !important;
    padding-top: env(safe-area-inset-top) !important;
  }
}

/* Fix pour les dropdowns coupés sur mobile */
.dropdown-menu,
.select-menu,
[role="menu"],
[role="listbox"],
.menu-dropdown {
  @media (max-width: 1023px) {
    position: fixed !important;
    z-index: 99999 !important;
    max-height: 60vh !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3) !important;
    
    /* S'assure qu'il reste dans l'écran */
    max-width: calc(100vw - 40px) !important;
    left: 20px !important;
    right: 20px !important;
    width: auto !important;
  }
}

/* Fix pour les modals sur mobile */
.modal, .dialog, [role="dialog"] {
  @media (max-width: 1023px) {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: calc(100vw - 40px) !important;
    max-width: 500px !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    border-radius: 16px !important;
    
    /* Safe areas */
    margin-left: env(safe-area-inset-left) !important;
    margin-right: env(safe-area-inset-right) !important;
  }
}

/* Fix pour les tooltips sur mobile */
.tooltip, [role="tooltip"] {
  @media (max-width: 1023px) {
    position: fixed !important;
    z-index: 99999 !important;
    max-width: calc(100vw - 40px) !important;
    padding: 12px 16px !important;
    font-size: 14px !important;
    border-radius: 12px !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
  }
}

/* ==================== OPTIMISATIONS TACTILES ==================== */

/* Optimisations pour les inputs sur mobile */
input, textarea, select {
  @media (max-width: 1023px) {
    /* Empêche le zoom automatique sur iOS */
    font-size: 16px !important;
    
    /* Zone tactile minimum */
    min-height: 44px !important;
    
    /* Améliore l'apparence */
    border-radius: 8px !important;
    padding: 12px 16px !important;
    
    /* Touch optimisé */
    touch-action: manipulation !important;
  }
}

/* Améliore les boutons sur mobile */
button, .btn, [role="button"] {
  @media (max-width: 1023px) {
    /* Zone tactile minimum */
    min-height: 44px !important;
    min-width: 44px !important;
    
    /* Touch feedback */
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1) !important;
    
    /* Améliore l'apparence */
    border-radius: 8px !important;
    padding: 12px 16px !important;
    
    /* Évite les effets hover problématiques */
    &:hover {
      transform: none !important;
    }
    
    &:active {
      transform: scale(0.98) !important;
    }
  }
}

/* Fix pour les liens sur mobile */
a {
  @media (max-width: 1023px) {
    /* Zone tactile pour petits liens */
    min-height: 44px !important;
    display: inline-flex !important;
    align-items: center !important;
    
    /* Touch feedback */
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1) !important;
    touch-action: manipulation !important;
  }
}

/* ==================== RESPONSIVE CONTAINER SYSTEM ==================== */
@layer components {
  .container {
    @apply w-full mx-auto px-4 sm:px-6 lg:px-8;
    max-width: 100%;
  }

  /* ============ RESPONSIVE CARDS ============ */
  .card {
    @apply bg-surface rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg border border-blue-100 dark:border-gray-700;
  }
  
  /* Mobile card optimizations */
  @media (max-width: 768px) {
    .card {
      @apply rounded-md shadow-sm;
      /* Réduit les ombres sur mobile pour améliorer les performances */
      margin-bottom: 1rem;
    }
  }

  /* ============ RESPONSIVE BUTTONS ============ */
  .btn {
    @apply px-6 py-2 rounded-md font-medium text-white transition-all duration-300 transform hover:translate-y-[-2px] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background uppercase tracking-wider text-sm shadow-md;
  }
  
  /* Mobile button optimizations */
  @media (max-width: 768px) {
    .btn {
      @apply px-4 py-3 text-base;
      /* Plus gros sur mobile pour une meilleure accessibilité tactile */
      min-height: 44px; /* Minimum Apple/Google recommandé pour le tactile */
    }
    
    /* Supprime les effets de hover sur mobile qui peuvent poser problème */
    .btn:hover {
      transform: none;
    }
  }

  .btn-primary {
    @apply bg-primary hover:bg-blue-600 focus:ring-primary;
  }

  .btn-secondary {
    @apply bg-secondary hover:bg-indigo-600 focus:ring-secondary;
  }

  /* ============ RESPONSIVE INPUTS ============ */
  .input {
    @apply w-full px-4 py-2 rounded-md border-2 border-blue-200 dark:border-gray-600 bg-surface text-text focus:border-blue-400 dark:focus:border-blue-300 focus:ring focus:ring-blue-200 dark:focus:ring-blue-700 focus:ring-opacity-50 transition-all duration-300 placeholder-gray-400 dark:placeholder-gray-500;
  }
  
  /* Mobile input optimizations */
  @media (max-width: 768px) {
    .input {
      @apply px-3 py-3 text-base;
      /* Empêche le zoom automatique sur iOS */
      font-size: 16px;
      min-height: 44px;
    }
  }

  .select {
    @apply w-full px-4 py-2 rounded-md border-2 border-blue-200 dark:border-gray-600 bg-surface text-text focus:border-blue-400 dark:focus:border-blue-300 focus:ring focus:ring-blue-200 dark:focus:ring-blue-700 focus:ring-opacity-50 transition-all duration-300 appearance-none;
  }
  
  /* Mobile select optimizations */
  @media (max-width: 768px) {
    .select {
      @apply px-3 py-3 text-base;
      font-size: 16px;
      min-height: 44px;
    }
  }

  /* ============ RESPONSIVE QUESTION CARDS ============ */
  .question-card {
    @apply bg-surface rounded-lg shadow-sm p-6 mb-6 transition-all duration-300 hover:shadow-md border-l-4 border-blue-400 dark:border-blue-600;
    width: 100%;
    min-width: 300px;
    overflow-x: auto;
  }
  
  /* Mobile question card optimizations */
  @media (max-width: 768px) {
    .question-card {
      @apply p-4 mb-4 rounded-md;
      min-width: 100%;
      /* Scroll horizontal amélioré */
      -webkit-overflow-scrolling: touch;
    }
  }

  .option-card {
    @apply bg-blue-50 dark:bg-gray-700 rounded-md p-4 mb-3 transition-all duration-300 hover:bg-blue-100 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600;
  }
  
  /* Mobile option card optimizations */
  @media (max-width: 768px) {
    .option-card {
      @apply p-3 mb-2;
      min-height: 44px;
      display: flex;
      align-items: center;
    }
  }

  .sub-question {
    @apply ml-6 mt-4 border-l-2 border-indigo-300 dark:border-indigo-600 pl-4;
  }
  
  /* Mobile sub-question optimizations */
  @media (max-width: 768px) {
    .sub-question {
      @apply ml-3 pl-3;
    }
  }

  /* ============ RESPONSIVE HEADER ============ */
  .header {
    @apply bg-blue-600 dark:bg-gray-800 text-white shadow-md sticky top-0 z-50;
    /* Mobile: header fixe pour une meilleure navigation */
  }

  .header-content {
    @apply container mx-auto py-4 flex justify-between items-center;
  }
  
  /* Mobile header optimizations */
  @media (max-width: 768px) {
    .header-content {
      @apply py-3 px-4;
    }
  }

  .header-title {
    @apply text-3xl font-bold;
  }
  
  /* Mobile header title optimizations */
  @media (max-width: 768px) {
    .header-title {
      @apply text-2xl;
    }
  }

  .header-nav {
    @apply flex space-x-6;
  }
  
  /* Mobile header nav optimizations */
  @media (max-width: 768px) {
    .header-nav {
      @apply space-x-4;
    }
  }

  .header-link {
    @apply text-white hover:text-blue-200 dark:hover:text-blue-300 transition-colors duration-300 uppercase tracking-wider text-sm font-medium;
  }
  
  /* Mobile header link optimizations */
  @media (max-width: 768px) {
    .header-link {
      @apply text-xs py-2 px-1;
      min-height: 44px;
      display: flex;
      align-items: center;
    }
  }

  /* ============ RESPONSIVE MAIN TITLE ============ */
  .main-title {
    @apply text-4xl font-bold text-center mb-12 text-gray-800 dark:text-gray-200;
  }
  
  /* Mobile main title optimizations */
  @media (max-width: 768px) {
    .main-title {
      @apply text-2xl mb-6;
    }
  }

  /* ============ RESPONSIVE QUESTIONNAIRE LAYOUT ============ */
  .questionnaire-layout {
    @apply flex flex-wrap;
  }
  
  /* Mobile questionnaire layout - force la disposition en colonne */
  @media (max-width: 1024px) {
    .questionnaire-layout {
      @apply flex-col;
    }
  }

  .questionnaire-creator {
    @apply w-full lg:w-7/12 pr-0 lg:pr-4 mb-8 lg:mb-0;
  }
  
  /* Mobile questionnaire creator optimizations */
  @media (max-width: 1024px) {
    .questionnaire-creator {
      @apply w-full pr-0 mb-6;
    }
  }

  .questionnaire-preview {
    @apply w-full lg:w-5/12 pl-0 lg:pl-4;
  }
  
  /* Mobile questionnaire preview optimizations */
  @media (max-width: 1024px) {
    .questionnaire-preview {
      @apply w-full pl-0;
    }
  }

  /* ============ OPTION TEXT MOBILE ============ */
  .questionnaire-option {
    @apply text-gray-700 dark:text-white;
  }
  
  /* Mobile questionnaire option optimizations */
  @media (max-width: 768px) {
    .questionnaire-option {
      font-size: 16px; /* Évite le zoom sur iOS */
      line-height: 1.5;
    }
  }
}

/* ==================== PERFORMANCES MOBILE ==================== */

/* Performance optimizations pour mobile */
@media (max-width: 1023px) {
  /* GPU acceleration pour les éléments qui bougent */
  .animated,
  .transition,
  [class*="transition"],
  [class*="animate"] {
    -webkit-transform: translateZ(0) !important;
    transform: translateZ(0) !important;
    -webkit-backface-visibility: hidden !important;
    backface-visibility: hidden !important;
    will-change: transform !important;
  }
  
  /* Réduit les animations sur mobile pour les performances */
  * {
    animation-duration: 0.3s !important;
    transition-duration: 0.3s !important;
  }
  
  /* Optimise les images */
  img {
    -webkit-transform: translateZ(0) !important;
    transform: translateZ(0) !important;
    image-rendering: -webkit-optimize-contrast !important;
  }
}

/* ==================== VIEWPORT ET ORIENTATIONS ==================== */

/* Fix pour le viewport sur mobile */
@media (max-width: 1023px) {
  /* Support du viewport dynamique */
  .full-height,
  .vh-100,
  [style*="100vh"] {
    height: 100dvh !important;
    min-height: 100dvh !important;
  }
  
  /* Fix pour les éléments sticky */
  .sticky,
  [style*="sticky"] {
    position: -webkit-sticky !important;
    position: sticky !important;
  }
}

/* ==================== SCROLLBAR OPTIMISATIONS ==================== */

/* Améliore les scrollbars sur mobile */
@media (max-width: 768px) {
  /* Cache les scrollbars sur mobile tout en gardant la fonctionnalité */
  ::-webkit-scrollbar {
    width: 0;
    background: transparent;
  }
  
  * {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
}

/* ==================== UTILITIES RESPONSIVES ==================== */

/* Classes utilitaires pour mobile */
.mobile-hidden {
  @media (max-width: 768px) {
    display: none !important;
  }
}

.mobile-only {
  display: none;
  
  @media (max-width: 768px) {
    display: block;
  }
}

.desktop-only {
  @media (max-width: 768px) {
    display: none !important;
  }
}

/* ==================== SAFE AREAS (iPhone X+) ==================== */

@media (max-width: 768px) {
  .mobile-safe-area {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .mobile-safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
}

/* Support pour notch iPhone avec max() */
@media (max-width: 1023px) {
  @supports (padding: max(0px)) {
    .safe-area-container {
      padding-left: max(env(safe-area-inset-left), 0px) !important;
      padding-right: max(env(safe-area-inset-right), 0px) !important;
      padding-top: max(env(safe-area-inset-top), 0px) !important;
      padding-bottom: max(env(safe-area-inset-bottom), 0px) !important;
    }
  }
}

/* ==================== DARK MODE OPTIMIZATIONS ==================== */

@media (prefers-color-scheme: dark) {
  /* Améliore la lisibilité en mode sombre */
  input, textarea, select {
    color-scheme: dark !important;
  }
  
  /* Optimise les scrollbars en mode sombre */
  ::-webkit-scrollbar {
    background-color: rgba(255, 255, 255, 0.1) !important;
  }
  
  ::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3) !important;
  }
}

/* ==================== ACCESSIBILITY ==================== */

/* Respect des préférences utilisateur */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Améliore le focus pour les utilisateurs de clavier */
@media (max-width: 1023px) {
  button:focus,
  a:focus,
  input:focus,
  textarea:focus,
  select:focus,
  [tabindex]:focus {
    outline: 3px solid rgb(var(--color-accent)) !important;
    outline-offset: 2px !important;
  }
}

/* ==================== HAUTEUR MOBILE FIXES ==================== */

/* Fix pour les hauteurs correctes sur mobile */
@media (max-width: 768px) {
  html, body {
    height: 100%;
    height: -webkit-fill-available; /* Fix pour iOS Safari */
  }
  
  #root {
    min-height: 100vh;
    min-height: -webkit-fill-available; /* Fix pour iOS Safari */
  }
  
  /* Fix pour le clavier virtuel sur mobile */
  .mobile-input-container {
    padding-bottom: env(keyboard-inset-height, 0);
  }
}

/* ==================== TOUCH IMPROVEMENTS ==================== */

@media (max-width: 768px) {
  /* Améliore les interactions tactiles */
  button, a, [role="button"] {
    min-height: 44px;
    min-width: 44px;
    touch-action: manipulation;
  }
  
  /* Empêche la sélection de texte accidentelle */
  .no-select-mobile {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  /* Améliore les performances d'animation sur mobile */
  .mobile-optimized {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
}

/* Underline utility */
u {
  text-decoration: underline;
}

/* Global layout fixes */
html, body, #root {
  height: 100%;
  margin: 0;
  padding: 0;
}

#root {
  display: flex;
  flex-direction: column;
  
  /* Mobile: assure une hauteur correcte */
  @media (max-width: 768px) {
    min-height: 100vh;
    min-height: -webkit-fill-available; /* Fix pour iOS */
  }
}