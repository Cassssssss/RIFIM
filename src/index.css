@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --color-primary: 59 130 246;
  --color-secondary: 99 102 241;
  --color-accent: 236 72 153;
  --color-background: 249 250 251;
  --color-surface: 255 255 255;
  --color-text: 31 41 55;
}

.dark {
  --color-primary: 96 165 250;
  --color-secondary: 129 140 248;
  --color-accent: 244 114 182;
  --color-background: 17 24 39;
  --color-surface: 31 41 55;
  --color-text: 243 244 246;
}

/* ============ BASE STYLES AVEC SUPPORT MOBILE CORRIGÉ ============ */
html {
  scroll-behavior: smooth;
  /* Fix pour les hauteurs sur mobile */
  height: 100%;
  
  @media (max-width: 768px) {
    /* Fix critique pour iOS */
    height: -webkit-fill-available;
    /* Empêche le zoom sur double tap */
    touch-action: manipulation;
  }
}

body {
  font-family: 'Poppins', sans-serif;
  @apply bg-background text-text;
  margin: 0;
  padding: 0;
  height: 100%;
  
  /* CORRECTIONS CRITIQUES POUR LE DÉFILEMENT MOBILE */
  @media (max-width: 768px) {
    /* Améliore le défilement tactile */
    -webkit-overflow-scrolling: touch;
    /* Empêche le rebond élastique */
    overscroll-behavior: none;
    /* Améliore la performance du rendu */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* Ajustement automatique de la taille du texte */
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    /* Support pour les safe areas iPhone */
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    /* Fix pour la hauteur sur iOS */
    min-height: 100vh;
    min-height: -webkit-fill-available;
    /* Empêche les problèmes de positionnement */
    position: relative;
  }
  
  /* Classe pour empêcher le scroll quand le menu mobile est ouvert */
  &.menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    
    @media (max-width: 768px) {
      height: 100vh;
      height: -webkit-fill-available;
    }
  }
}

#root {
  height: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  
  @media (max-width: 768px) {
    /* Assure une hauteur correcte sur mobile */
    min-height: 100vh;
    min-height: -webkit-fill-available;
    /* Permet le défilement naturel */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

.font-report {
  font-family: 'Lato', 'Calibri', 'Arial', sans-serif;
}

/* ============ CORRECTIONS SCROLLBAR MOBILE ============ */
@media (max-width: 768px) {
  /* Cache les scrollbars sur mobile mais garde la fonctionnalité */
  ::-webkit-scrollbar {
    width: 0;
    height: 0;
    background: transparent;
  }
  
  * {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  *::-webkit-scrollbar {
    display: none;
  }
}

/* ============ RESPONSIVE CONTAINER SYSTEM ============ */
@layer components {
  .container {
    @apply w-full mx-auto px-4 sm:px-6 lg:px-8;
    max-width: 100%;
    
    @media (max-width: 768px) {
      @apply px-3;
      /* Améliore le défilement dans les conteneurs */
      overflow-x: hidden;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  /* ============ RESPONSIVE CARDS ============ */
  .card {
    @apply bg-surface rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-lg border border-blue-100 dark:border-gray-700;
    
    @media (max-width: 768px) {
      @apply rounded-md shadow-sm;
      margin-bottom: 1rem;
      /* Optimise le défilement dans les cartes */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* Empêche les problèmes de redimensionnement */
      contain: layout;
    }
  }

  /* ============ RESPONSIVE BUTTONS AVEC OPTIMISATIONS TACTILES ============ */
  .btn {
    @apply px-6 py-2 rounded-md font-medium text-white transition-all duration-300 transform hover:translate-y-[-2px] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-background uppercase tracking-wider text-sm shadow-md;
    
    @media (max-width: 768px) {
      @apply px-4 py-3 text-base;
      /* Taille tactile minimum recommandée */
      min-height: 44px;
      min-width: 44px;
      /* Optimise les interactions tactiles */
      touch-action: manipulation;
      /* Supprime les effets de hover sur mobile */
      transform: none !important;
      
      &:hover {
        transform: none !important;
      }
      
      &:active {
        /* Feedback tactile léger */
        transform: scale(0.98);
      }
    }
  }

  .btn-primary {
    @apply bg-primary hover:bg-blue-600 focus:ring-primary;
  }

  .btn-secondary {
    @apply bg-secondary hover:bg-indigo-600 focus:ring-secondary;
  }

  /* ============ RESPONSIVE INPUTS OPTIMISÉS ============ */
  .input {
    @apply w-full px-4 py-2 rounded-md border-2 border-blue-200 dark:border-gray-600 bg-surface text-text focus:border-blue-400 dark:focus:border-blue-300 focus:ring focus:ring-blue-200 dark:focus:ring-blue-700 focus:ring-opacity-50 transition-all duration-300 placeholder-gray-400 dark:placeholder-gray-500;
    
    @media (max-width: 768px) {
      @apply px-3 py-3 text-base;
      /* Empêche le zoom automatique sur iOS */
      font-size: 16px;
      min-height: 44px;
      /* Optimise les interactions tactiles */
      touch-action: manipulation;
    }
  }

  .select {
    @apply w-full px-4 py-2 rounded-md border-2 border-blue-200 dark:border-gray-600 bg-surface text-text focus:border-blue-400 dark:focus:border-blue-300 focus:ring focus:ring-blue-200 dark:focus:ring-blue-700 focus:ring-opacity-50 transition-all duration-300 appearance-none;
    
    @media (max-width: 768px) {
      @apply px-3 py-3 text-base;
      font-size: 16px;
      min-height: 44px;
      touch-action: manipulation;
    }
  }

  /* ============ RESPONSIVE QUESTION CARDS ============ */
  .question-card {
    @apply bg-surface rounded-lg shadow-sm p-6 mb-6 transition-all duration-300 hover:shadow-md border-l-4 border-blue-400 dark:border-blue-600;
    width: 100%;
    min-width: 300px;
    
    @media (max-width: 768px) {
      @apply p-4 mb-4 rounded-md;
      min-width: 100%;
      /* Améliore le défilement horizontal si nécessaire */
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      /* Empêche les débordements verticaux indésirables */
      overflow-y: visible;
    }
  }

  .option-card {
    @apply bg-blue-50 dark:bg-gray-700 rounded-md p-4 mb-3 transition-all duration-300 hover:bg-blue-100 dark:hover:bg-gray-600 border border-blue-200 dark:border-gray-600;
    
    @media (max-width: 768px) {
      @apply p-3 mb-2;
      min-height: 44px;
      display: flex;
      align-items: center;
      /* Optimise les interactions tactiles */
      touch-action: manipulation;
      
      &:hover {
        /* Supprime les effets hover sur mobile */
        @apply bg-blue-50 dark:bg-gray-700;
      }
    }
  }

  .sub-question {
    @apply ml-6 mt-4 border-l-2 border-indigo-300 dark:border-indigo-600 pl-4;
    
    @media (max-width: 768px) {
      @apply ml-3 pl-3;
    }
  }

  /* ============ RESPONSIVE HEADER ============ */
  .header {
    @apply bg-blue-600 dark:bg-gray-800 text-white shadow-md sticky top-0 z-50;
    
    @media (max-width: 768px) {
      /* Assure que le header reste en haut */
      position: sticky;
      top: 0;
      /* Support pour les safe areas */
      padding-top: env(safe-area-inset-top);
    }
  }

  .header-content {
    @apply container mx-auto py-4 flex justify-between items-center;
    
    @media (max-width: 768px) {
      @apply py-3 px-4;
    }
  }

  .header-title {
    @apply text-3xl font-bold;
    
    @media (max-width: 768px) {
      @apply text-2xl;
    }
  }

  .header-nav {
    @apply flex space-x-6;
    
    @media (max-width: 768px) {
      @apply space-x-4;
    }
  }

  .header-link {
    @apply text-white hover:text-blue-200 dark:hover:text-blue-300 transition-colors duration-300 uppercase tracking-wider text-sm font-medium;
    
    @media (max-width: 768px) {
      @apply text-xs py-2 px-1;
      min-height: 44px;
      display: flex;
      align-items: center;
      touch-action: manipulation;
    }
  }

  /* ============ RESPONSIVE MAIN TITLE ============ */
  .main-title {
    @apply text-4xl font-bold text-center mb-12 text-gray-800 dark:text-gray-200;
    
    @media (max-width: 768px) {
      @apply text-2xl mb-6;
    }
  }

  /* ============ RESPONSIVE QUESTIONNAIRE LAYOUT CORRIGÉ ============ */
  .questionnaire-layout {
    @apply flex flex-wrap;
    
    @media (max-width: 1024px) {
      @apply flex-col;
      /* Améliore le défilement sur mobile */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  .questionnaire-creator {
    @apply w-full lg:w-7/12 pr-0 lg:pr-4 mb-8 lg:mb-0;
    
    @media (max-width: 1024px) {
      @apply w-full pr-0 mb-6;
      /* Optimise le défilement */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  .questionnaire-preview {
    @apply w-full lg:w-5/12 pl-0 lg:pl-4;
    
    @media (max-width: 1024px) {
      @apply w-full pl-0;
      /* Optimise le défilement */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  /* ============ OPTION TEXT MOBILE ============ */
  .questionnaire-option {
    @apply text-gray-700 dark:text-white;
    
    @media (max-width: 768px) {
      font-size: 16px; /* Évite le zoom sur iOS */
      line-height: 1.5;
    }
  }

  /* ============ MOBILE MEDIA QUERIES GLOBALES CORRIGÉES ============ */
  @media (max-width: 768px) {
    .questionnaire-layout {
      @apply flex-col;
    }
    
    .questionnaire-creator,
    .questionnaire-preview {
      @apply w-full;
      /* CORRECTION CRITIQUE : Assure un défilement fluide */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    
    /* Espacement mobile optimisé */
    .container {
      @apply px-3;
    }
    
    /* Grilles responsive */
    .grid {
      @apply grid-cols-1;
    }
    
    /* Tables responsive */
    .table-responsive {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      /* Empêche les problèmes de débordement vertical */
      overflow-y: visible;
    }
    
    /* Modals mobile avec défilement corrigé */
    .modal {
      @apply mx-2;
      max-height: 90vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* Support pour les safe areas */
      margin-bottom: env(safe-area-inset-bottom);
    }
  }
  
  /* ============ TABLET BREAKPOINT ============ */
  @media (min-width: 769px) and (max-width: 1024px) {
    .grid-tablet-2 {
      @apply grid-cols-2;
    }
    
    .questionnaire-layout {
      @apply flex-col;
    }
  }
}

/* ============ GLOBAL MOBILE OPTIMIZATIONS CORRIGÉES ============ */
u {
  text-decoration: underline;
}

/* ============ MOBILE TOUCH IMPROVEMENTS CORRIGÉS ============ */
@media (max-width: 768px) {
  /* Améliore les interactions tactiles */
  button, a, [role="button"] {
    min-height: 44px;
    min-width: 44px;
    touch-action: manipulation;
    /* Empêche la surbrillance tactile */
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Empêche la sélection de texte accidentelle */
  .no-select-mobile {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    touch-action: manipulation;
  }
  
  /* CORRECTION CRITIQUE : Améliore les performances d'animation */
  * {
    /* Évite les transformations 3D non nécessaires */
    transform: translateZ(0);
    /* Optimise le rendu */
    will-change: auto;
  }
  
  /* Optimise le défilement dans tous les conteneurs */
  div, section, article, main {
    /* Améliore le défilement tactile si le conteneur peut défiler */
    &[style*="overflow"] {
      -webkit-overflow-scrolling: touch;
    }
  }
}

/* ============ MOBILE VIEWPORT FIXES CORRIGÉS ============ */
@media (max-width: 768px) {
  /* Fix pour les hauteurs sur mobile */
  .mobile-full-height {
    height: 100vh;
    height: -webkit-fill-available;
    /* Assure le défilement si nécessaire */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Fix pour le clavier virtuel sur mobile */
  .mobile-input-container {
    padding-bottom: env(keyboard-inset-height, 0);
    /* Maintient la scrollabilité */
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
}

/* ============ RESPONSIVE UTILITIES ============ */
.mobile-hidden {
  @media (max-width: 768px) {
    display: none !important;
  }
}

.mobile-only {
  display: none;
  
  @media (max-width: 768px) {
    display: block;
  }
}

.desktop-only {
  @media (max-width: 768px) {
    display: none !important;
  }
}

/* ============ MOBILE SAFE AREAS (iPhone X+) ============ */
@media (max-width: 768px) {
  .mobile-safe-area {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .mobile-safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
}

/* ============ CORRECTIONS SPÉCIFIQUES POUR LE DÉFILEMENT ============ */
@media (max-width: 768px) {
  /* Classe utilitaire pour forcer un bon défilement */
  .mobile-scroll-fix {
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;
    /* Empêche les problèmes de positionnement */
    position: relative !important;
  }
  
  /* Fix pour les contenus qui débordent */
  .mobile-content-fix {
    width: 100% !important;
    max-width: 100% !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
}

/* ============ PERFORMANCE OPTIMIZATIONS MOBILE ============ */
@media (max-width: 768px) {
  /* Optimise le rendering sur mobile */
  * {
    /* Évite les reflows coûteux */
    contain: layout style;
  }
  
  /* Optimise les images sur mobile */
  img {
    /* Améliore le rendu des images */
    image-rendering: optimizeQuality;
    /* Évite les débordements */
    max-width: 100%;
    height: auto;
  }
  
  /* Optimise les transitions sur mobile */
  * {
    transition-duration: 0.2s !important;
  }
}

@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';